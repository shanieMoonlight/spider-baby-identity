import{a as L}from"./chunk-RQLLEMPV.js";import{a as x}from"./chunk-LAXJKARQ.js";import"./chunk-E6PBY26I.js";import"./chunk-J7V4XGIJ.js";import{a as j}from"./chunk-YIT3BSWB.js";import{a as W}from"./chunk-UQNNMBE6.js";import{a as p}from"./chunk-5M6LSHM4.js";import{a as D}from"./chunk-QHIVMJYN.js";import"./chunk-2TXRH4OM.js";import"./chunk-BABM5QN5.js";import"./chunk-ZDQYZ24Q.js";import{a as A}from"./chunk-WKO4SONN.js";import{ca as C,da as U}from"./chunk-VJXHLJA5.js";import"./chunk-YCVKD4PR.js";import{a as T}from"./chunk-CWY6TGXW.js";import"./chunk-CU2LV2W6.js";import{c as d}from"./chunk-ZUYYKIIZ.js";import"./chunk-4XZ6Q3KQ.js";import"./chunk-XWDBGFUP.js";import"./chunk-VVB4K6R7.js";import"./chunk-Y5WPSY3K.js";import{A as m,Eb as g,Gb as k,Hc as f,Ic as V,Jb as R,Ob as c,Pb as a,Qb as E,R as b,S as F,U as S,Ub as v,Y as $,ca as n,db as s,ec as _,f as u,gc as y,mc as I,p as o,q as h,sb as P,x as w,xb as O}from"./chunk-CCUFKVTZ.js";import"./chunk-6MDQTQU3.js";var M=(()=>{class t{_ioService=n(T);_loginService=n(x);_actRoute=n(D);_redirectUrl$=this._actRoute.queryParamMap.pipe(o(e=>e.get(p.Params.REDIRECT_URL_KEY)),m(e=>!!e));redirectUrl=d(this._redirectUrl$,{initialValue:null});_token$=this._actRoute.queryParamMap.pipe(o(e=>e.get(p.Params.TWO_FACTOR_TOKEN_KEY)),m(e=>!!e));_token=d(this._token$,{initialValue:null});_provider$=this._actRoute.queryParamMap.pipe(o(e=>e.get(p.Params.TWO_FACTOR_PROVIDER_KEY)),m(e=>!!e));provider=d(this._provider$,{initialValue:null});invalidDataErrorMsg=f(()=>this._token()?void 0:"Invalid token.");_verifyCode$=new u;_verifyDto$=h([this._token$,this._verifyCode$]).pipe(o(([e,r])=>({token:e,code:r})));_verifyState=C.CreateWithObservableInput(this._verifyDto$,e=>this._loginService.verify2Factor(e)).setSuccessMsgFn(()=>"2FA verification successful!");_resendClick$=new u;_resendDto$=h([this._token$,this._resendClick$]).pipe(o(([e])=>({token:e})));_resendState=C.CreateWithObservableInput(this._resendDto$,e=>this._ioService.twoFactorResend(e)).setSuccessMsgFn((e,r)=>`${r.message||"2FA code has been resent!"}`);_states=U.Combine(this._verifyState,this._resendState);successMsg=this._states.successMsg;loading=this._states.loading;errorMsg=f(()=>this.invalidDataErrorMsg()||this._states.errorMsg());verifySuccess=f(()=>!!this._verifyState.successMsg());_cooldownSeconds=30;_cooldownCountdown$=this._resendClick$.pipe(F(()=>w(0,1e3).pipe(o(e=>this._cooldownSeconds-e),S(e=>e>=0))),b(0));resendCooldownCountdown=d(this._cooldownCountdown$,{initialValue:0});verify2Factor=e=>this._verifyCode$.next(e);resend2Factor=()=>this._resendClick$.next();static \u0275fac=function(r){return new(r||t)};static \u0275prov=$({token:t,factory:t.\u0275fac})}return t})();function B(t,Y){t&1&&(c(0,"p",2),_(1),a()),t&2&&(s(),y("Provider: ",Y,""))}var me=(()=>{class t{_state=n(M);_router=n(j);_successMsg=this._state.successMsg;_errorMsg=this._state.errorMsg;_loading=this._state.loading;_resendCooldownCountdown=this._state.resendCooldownCountdown;_provider=this._state.provider;constructor(){V(()=>{if(this._state.verifySuccess()){let e=this._state.redirectUrl();e?this._router.navigate([e]):this._router.navigateToHome()}})}verify2Factor=e=>this._state.verify2Factor(e.token);resend2Factor(){return this._state.resend2Factor()}static \u0275fac=function(r){return new(r||t)};static \u0275cmp=P({type:t,selectors:[["sb-verify-2-factor"]],features:[I([M])],decls:9,vars:8,consts:[[1,"container"],[1,"header"],[1,"description"],[1,"verify-2factor-form",3,"verify2Factor"],["color","error",1,"resend-confirmation-btn",3,"click","disabled"],[3,"errorMsg","successMsg","isLoading"]],template:function(r,i){if(r&1&&(c(0,"div",0)(1,"div",1)(2,"h2"),_(3,"Verify 2-Factor"),a(),O(4,B,2,1,"p",2),a(),c(5,"sb-verify-2factor-form",3),v("verify2Factor",function(K){return i.verify2Factor(K)}),a(),c(6,"sb-button",4),v("click",function(){return i.resend2Factor()}),_(7),a()(),E(8,"sb-notifications-modal-mat",5)),r&2){let l;s(4),R((l=i._provider())?4:-1,l),s(2),k("show",i._errorMsg()),g("disabled",i._resendCooldownCountdown()>0),s(),y(" Resend Code ",i._resendCooldownCountdown()>0?`(${i._resendCooldownCountdown()})`:""," "),s(),g("errorMsg",i._errorMsg())("successMsg",i._successMsg())("isLoading",i._loading())}},dependencies:[A,L,W],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;width:100%;width:calc(100% - 2rem);min-height:calc(100% - 2rem);align-items:center;justify-content:center;padding:1rem}.container[_ngcontent-%COMP%]{width:98%;max-width:450px;display:flex;align-items:center;flex-direction:column;justify-content:center}.header[_ngcontent-%COMP%]{margin-bottom:3rem}.header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{text-align:center;margin-bottom:.5rem;font-weight:600}.header[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]{text-align:center;color:var(--mat-sys-on-surface-variant);font-size:.95rem;line-height:1.4}.verify-2factor-form[_ngcontent-%COMP%]{width:100%}sb-button[_ngcontent-%COMP%]{opacity:0;pointer-events:none;transform:translateY(40px) scale(.98);margin:2rem 0;width:100%}sb-button.show[_ngcontent-%COMP%]{opacity:1;transform:translateY(0) scale(1);pointer-events:auto}"],changeDetection:0})}return t})();export{me as Verify2FactorComponent};
