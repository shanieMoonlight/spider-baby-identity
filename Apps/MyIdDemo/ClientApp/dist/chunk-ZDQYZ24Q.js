import{b as I}from"./chunk-ZUYYKIIZ.js";import{a as C}from"./chunk-4XZ6Q3KQ.js";import{s as g}from"./chunk-Y5WPSY3K.js";import{Da as h,Hc as a,Ia as f,Ic as M,Y as d,ca as u,ub as T,yc as b}from"./chunk-CCUFKVTZ.js";import{e as D}from"./chunk-6MDQTQU3.js";var x=(()=>{class r{_platformId=u(f);isBrowser=()=>g(this._platformId);get length(){return this.isBrowser()?localStorage.length:0}clear(){this.isBrowser()&&localStorage.clear()}getItem(t){return this.isBrowser()?localStorage.getItem(t):null}getItemObject(t){if(!this.isBrowser())return null;try{let e=localStorage.getItem(t);return e?JSON.parse(e):null}catch(e){return console.error(`Error parsing item with key "${t}":`,e),null}}key(t){return this.isBrowser()?localStorage.key(t):null}removeItem(t){this.isBrowser()&&localStorage.removeItem(t)}setItem(t,e){if(this.isBrowser())try{localStorage.setItem(t,e)}catch(i){console.error(`Error setting item with key "${t}":`,i)}}setItemObject(t,e){if(this.isBrowser())try{localStorage.setItem(t,JSON.stringify(e))}catch(i){console.error(`Error setting object with key "${t}":`,i)}}static \u0275fac=function(e){return new(e||r)};static \u0275prov=d({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();var S="spider_baby_auth_key",L=(()=>{class r{_localStorage=u(x);storeJwt=t=>t?this._localStorage.setItem(S,t):this.removeJwt();removeJwt=()=>this._localStorage.removeItem(S);getStoredToken=()=>this._localStorage.getItem(S);static \u0275fac=function(e){return new(e||r)};static \u0275prov=d({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();function v(r){return typeof r=="number"?!isNaN(r)&&isFinite(r):typeof r=="string"&&r.trim()!==""?!isNaN(Number(r))&&isFinite(Number(r)):!1}var l=class r{static Millsecond=1;static Second=1e3*r.Millsecond;static Minute=60*r.Second;static Hour=60*r.Minute;static Day=24*r.Hour;static Week=7*r.Day},k=class{static Second=1;static Minute=60*l.Second;static Hour=60*l.Minute;static Day=24*l.Hour;static Week=7*l.Day;static Month=30*l.Day;static Year=365*l.Day};var V=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],E=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],m=(()=>{class r{static fromMilliSeconds(t){try{return!v(t)||t<0?void 0:new Date(t)}catch{return}}static fromSeconds=t=>r.fromMilliSeconds((t??0)*l.Second);static formatYearMonthDay(t=new Date,e="-"){let i=new Date(t),s=i.getFullYear(),n=""+(i.getMonth()+1),c=""+i.getDate();return n.length<2&&(n="0"+n),c.length<2&&(c="0"+c),[s,n,c].join(e)}static to_dd_MMM_YYYY(t){if(!t)return"";let e=new Date(t),i=e.toLocaleString("default",{day:"2-digit"}),s=e.toLocaleString("default",{month:"short"}),n=e.toLocaleString("default",{year:"numeric"});return i+"-"+s+"-"+n}static dd_MMM_YYYY_HH_mm(t){if(!t)return"";let e=new Date(t),i=e.toLocaleString("default",{day:"2-digit"}),s=e.toLocaleString("default",{month:"short"}),n=e.toLocaleString("default",{year:"numeric"}),c=String(e.getHours()).padStart(2,"0"),w=String(e.getMinutes()).padStart(2,"0");return`${i}-${s}-${n} ${c}:${w}`}static to_dd_MMM_YYYY_Or_Undefined(t){if(!t)return;let e=new Date(t),i=e.toLocaleString("default",{day:"2-digit"}),s=e.toLocaleString("default",{month:"short"}),n=e.toLocaleString("default",{year:"numeric"});return i+"-"+s+"-"+n}static toSafeDate(t){if(!t)return new Date;try{return new Date(t)}catch{return new Date}}static toIonicDate(t){let e=t?new Date(t):new Date,i=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0"),n=String(e.getDate()).padStart(2,"0"),c=String(e.getHours()).padStart(2,"0"),w=String(e.getMinutes()).padStart(2,"0");return`${i}-${s}-${n}T${c}:${w}`}static withoutTime(t){let e=t?new Date(t):new Date;return e.setHours(0,0,0,0),e}static isToday(t){if(!t)return!1;let e=new Date;return this.withoutTime(e).getTime()===this.withoutTime(t).getTime()}static isTomorrow(t){if(!t)return!1;let e=new Date,i=new Date;return i.setDate(e.getDate()+1),this.withoutTime(i).getTime()===this.withoutTime(t).getTime()}static daysAgo(t){let i=new Date(t),s=Math.abs(new Date().getTime()-i.getTime());return Math.round(s/864e5)}static isWeekend(t){if(!t)return!1;let i=this.toSafeDate(t).getDay();return i===0||i===6}static weekdayNameFull(t){let e=new Date(t);return V[e.getDay()]}static weekdayNameShort(t){let e=new Date(t);return E[e.getDay()]}}return r})();var y=class r{type;value;constructor(o,t){this.type=o,this.value=t}static Create(o,t){return new r(o,t)}};var p=class{static urlBase64Decode(o){let t=o.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw new Error("Illegal base64url string!")}if(typeof window<"u"&&typeof window.atob=="function")return decodeURIComponent(encodeURI(window.atob(t)));if(typeof Buffer<"u")return Buffer.from(t,"base64").toString("utf-8");throw new Error("No base64 decoder available in this environment")}static decodeToken(o){if(!o)throw new Error("JWT must not be null");let t=o.split(".");if(t.length!==3)throw new Error("JWT must have 3 parts");let e=this.urlBase64Decode(t[1]);if(!e)throw new Error("Cannot decode the token");return JSON.parse(e)}static isRawTokenExpired(o){try{let t=this.decodeToken(o);return this.isTokenExpired(t)}catch{return!0}}static isTokenExpired(o){try{let t=Date.now().valueOf()/1e3;return!!(!o?.exp||o.exp<t||o?.nbf&&o.nbf>t)}catch{return!0}}};var rt=(()=>{class r{_platformId=u(f);_isReady=h(!1);isReady=a(()=>this._isReady());isReady$=I(this.isReady);isPlatformBrowser=a(()=>g(this._platformId));expiryTimeout;_accessToken=h(null);accessToken=a(()=>this._accessToken());jwtPayload=a(()=>this.decodeToken(this._accessToken()));allClaimsRecord=a(()=>this.extractAllClaimsRecord(this.jwtPayload()));allClaims=a(()=>Object.values(this.allClaimsRecord()));roles=a(()=>{let t=this.getClaimValue("role");return t?Array.isArray(t)?t:[t]:new Array});isLoggedIn=a(()=>!!this.jwtPayload());isNotLoggedIn=a(()=>!this.isLoggedIn());userName=a(()=>this.getClaimValue("name"));userId=a(()=>this.getClaimValue("sub"));email=a(()=>this.getClaimValue("email"));issuer=a(()=>this.getClaimValue("iss"));audience=a(()=>this.getClaimValue("aud"));emailVerified=a(()=>this.getClaimValue("email_verified")??!1);issuedAt=a(()=>m.fromSeconds(this.getClaimValue("iat")));expiry=a(()=>m.fromSeconds(this.getClaimValue("exp")));notBefore=a(()=>m.fromSeconds(this.getClaimValue("nbf")));authTime=a(()=>m.fromSeconds(this.getClaimValue("auth_time")));firstName=a(()=>this.getClaimValue("given_name"));lastName=a(()=>this.getClaimValue("family_name"));picture=a(()=>this.getClaimValue("picture"));locale=a(()=>this.getClaimValue("locale"));updatedAt=a(()=>this.getClaimValue("updated_at"));birthdate=a(()=>this.getClaimValue("birthdate"));gender=a(()=>this.getClaimValue("gender"));address=a(()=>this.getClaimValue("address"));profile=a(()=>this.getClaimValue("profile"));website=a(()=>this.getClaimValue("website"));isDevMode=h(b());constructor(){this.isPlatformBrowser()&&M(()=>{this.setupExpiryTimer(this.expiry())})}initAsync(){return D(this,null,function*(){if(!this.isPlatformBrowser()){this._isReady.set(!0);return}let t=yield this.getStoredToken();C.log("init, storedToken",t?.substring(0,15)+"..."),t&&this.logIn(t),this._isReady.set(!0)})}ngOnDestroy(){clearTimeout(this.expiryTimeout)}logIn(t){this.storeJwt(t),this._accessToken.set(t??null)}logOut(){return this.removeJwt(),this._accessToken.set(null)}hasRole=t=>this.roles().includes(t);isTokenStillValid=()=>{let t=this.expiry();return!!t&&new Date<t};hasClaimType=t=>!!t&&!!this.jwtPayload()?.[t];hasClaim=(t,e)=>this.jwtPayload()?.[t]==e;getClaimValue=t=>this.jwtPayload()?.[t];decodeToken(t){try{return t?p.decodeToken(t):null}catch(e){return this.logError?.({error:e,method:"decodeToken",accessToken:t}),null}}extractAllClaimsRecord(t){let e={};if(!t)return e;for(let i in t)e[i]=y.Create(i,t[i]);return e}onExpiry(){this.logOut()}setupExpiryTimer(t){if(clearTimeout(this.expiryTimeout),!t)return;let e=t.getTime()-Date.now();if(e<=0){this.onExpiry();return}let i=2147483647,s=Math.min(e,i);this.expiryTimeout=setTimeout(()=>{s===i?this.setupExpiryTimer(t):this.onExpiry()},s)}static \u0275fac=function(e){return new(e||r)};static \u0275dir=T({type:r})}return r})();export{x as a,L as b,rt as c};
