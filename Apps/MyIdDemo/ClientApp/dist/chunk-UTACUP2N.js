import{a as W}from"./chunk-RQLLEMPV.js";import{a as T}from"./chunk-LAXJKARQ.js";import"./chunk-E6PBY26I.js";import"./chunk-J7V4XGIJ.js";import{a as j}from"./chunk-YIT3BSWB.js";import{a as L}from"./chunk-UQNNMBE6.js";import{a as h}from"./chunk-5M6LSHM4.js";import{a as x}from"./chunk-QHIVMJYN.js";import"./chunk-2TXRH4OM.js";import"./chunk-BABM5QN5.js";import"./chunk-ZDQYZ24Q.js";import{a as U}from"./chunk-WKO4SONN.js";import{ca as C,da as A}from"./chunk-VJXHLJA5.js";import"./chunk-YCVKD4PR.js";import{a as D}from"./chunk-CWY6TGXW.js";import"./chunk-CU2LV2W6.js";import{c as m}from"./chunk-ZUYYKIIZ.js";import"./chunk-4XZ6Q3KQ.js";import"./chunk-XWDBGFUP.js";import"./chunk-VVB4K6R7.js";import"./chunk-Y5WPSY3K.js";import{A as _,Eb as p,Gb as O,Hc as v,Ic as E,Jb as R,Ob as c,Pb as s,Qb as I,R as b,S as F,U as S,Ub as u,Y as k,ca as r,db as n,ec as l,f,gc as g,mc as V,p as a,q as M,sb as P,x as w,xb as $}from"./chunk-CCUFKVTZ.js";import"./chunk-6MDQTQU3.js";var y=(()=>{class t{_ioService=r(D);_loginService=r(T);_actRoute=r(x);_redirectUrl$=this._actRoute.queryParamMap.pipe(a(e=>e.get(h.Params.REDIRECT_URL_KEY)),_(e=>!!e));redirectUrl=m(this._redirectUrl$,{initialValue:null});_provider$=this._actRoute.queryParamMap.pipe(a(e=>e.get(h.Params.TWO_FACTOR_PROVIDER_KEY)),_(e=>!!e));provider=m(this._provider$,{initialValue:null});_verifyCode$=new f;_verifyDto$=M([this._verifyCode$]).pipe(a(([e])=>({code:e})));_verifyState=C.CreateWithObservableInput(this._verifyDto$,e=>this._loginService.verify2FactorCookie(e)).setSuccessMsgFn(()=>"2FA verification successful!");_resendClick$=new f;_resendState=C.CreateWithObservableInput(this._resendClick$,()=>this._ioService.twoFactorResendCookie()).setSuccessMsgFn((e,i)=>`${i.message||"2FA code has been resent!"}`);_states=A.Combine(this._verifyState,this._resendState);successMsg=this._states.successMsg;loading=this._states.loading;errorMsg=v(()=>this._states.errorMsg());verifySuccess=v(()=>!!this._verifyState.successMsg());_cooldownSeconds=30;_cooldownCountdown$=this._resendClick$.pipe(F(()=>w(0,1e3).pipe(a(e=>this._cooldownSeconds-e),S(e=>e>=0))),b(0));resendCooldownCountdown=m(this._cooldownCountdown$,{initialValue:0});verify2Factor=e=>{console.log("verify2Factor - Cookie",e),this._verifyCode$.next(e)};resend2Factor=()=>this._resendClick$.next();static \u0275fac=function(i){return new(i||t)};static \u0275prov=k({token:t,factory:t.\u0275fac})}return t})();function K(t,Y){t&1&&(c(0,"p",2),l(1),s()),t&2&&(n(),g("Provider: ",Y,""))}var me=(()=>{class t{_state=r(y);_router=r(j);_successMsg=this._state.successMsg;_errorMsg=this._state.errorMsg;_loading=this._state.loading;_resendCooldownCountdown=this._state.resendCooldownCountdown;_provider=this._state.provider;constructor(){E(()=>{if(this._state.verifySuccess()){let e=this._state.redirectUrl();e?this._router.navigate([e]):this._router.navigateToHome()}})}verify2Factor=e=>this._state.verify2Factor(e.token);resend2Factor=()=>this._state.resend2Factor();static \u0275fac=function(i){return new(i||t)};static \u0275cmp=P({type:t,selectors:[["sb-verify-2-factor"]],features:[V([y])],decls:9,vars:8,consts:[[1,"container"],[1,"header"],[1,"description"],[1,"verify-2factor-form",3,"verify2Factor"],["color","error",1,"resend-confirmation-btn",3,"click","disabled"],[3,"errorMsg","successMsg","isLoading"]],template:function(i,o){if(i&1&&(c(0,"div",0)(1,"div",1)(2,"h2"),l(3,"Verify 2-Factor"),s(),$(4,K,2,1,"p",2),s(),c(5,"sb-verify-2factor-form",3),u("verify2Factor",function(q){return o.verify2Factor(q)}),s(),c(6,"sb-button",4),u("click",function(){return o.resend2Factor()}),l(7),s()(),I(8,"sb-notifications-modal-mat",5)),i&2){let d;n(4),R((d=o._provider())?4:-1,d),n(2),O("show",o._errorMsg()),p("disabled",o._resendCooldownCountdown()>0),n(),g(" Resend Code ",o._resendCooldownCountdown()>0?`(${o._resendCooldownCountdown()})`:""," "),n(),p("errorMsg",o._errorMsg())("successMsg",o._successMsg())("isLoading",o._loading())}},dependencies:[U,W,L],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;width:100%;width:calc(100% - 2rem);min-height:calc(100% - 2rem);align-items:center;justify-content:center;padding:1rem}.container[_ngcontent-%COMP%]{width:98%;max-width:450px;display:flex;align-items:center;flex-direction:column;justify-content:center}.header[_ngcontent-%COMP%]{margin-bottom:3rem}.header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{text-align:center;margin-bottom:.5rem;font-weight:600}.header[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]{text-align:center;color:var(--mat-sys-on-surface-variant);font-size:.95rem;line-height:1.4}.verify-2factor-form[_ngcontent-%COMP%]{width:100%}sb-button[_ngcontent-%COMP%]{opacity:0;pointer-events:none;transform:translateY(40px) scale(.98);margin:2rem 0;width:100%}sb-button.show[_ngcontent-%COMP%]{opacity:1;transform:translateY(0) scale(1);pointer-events:auto}"],changeDetection:0})}return t})();export{me as Verify2FactorCookieComponent};
